box: nodesource/node
services:
  - id: mongo
dev:
  steps:
    - npm-install
    - internal/watch:
        code: node 'src/server.js'
        reload: true

# Build definition
build:
  # The steps that will be executed on build
  steps:
    - script:
        code: export NODE_ENV='testing'
    # A step that executes `npm install` command
    - npm-install
    # A custom script step, name value is used in the UI
    # and the code value contains the command that get executed
    - script:
        name: echo nodejs information
        code: |
          echo "node version $(node -v) running"
          echo "npm version $(npm -v) running"
deploy:
  steps:
    - pip-install
    - internal/docker-push:
        username: $DOCKER_USERNAME
        password: $DOCKER_PASSWORD
        repository: davegri/librecrawler
        cmd: python crawl.py
        registry: https://registry.hub.docker.com
    - add-ssh-key:
        keyname: DIGITAL_OCEAN
    - add-to-known_hosts:
        hostname: $LIBRESTOCK_SERVER_IP
    - script:
        name: download image
        code: ssh root@$LIBRESTOCK_SERVER_IP docker pull davegri/librestock
